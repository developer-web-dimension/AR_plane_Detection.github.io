<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebXR Plane Detection</title>
    <style>
      body, html {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
      }
      #enter-ar {
        position: absolute;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
        padding: 10px 20px;
        background: #4CAF50;
        color: white;
        border: none;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <button id="enter-ar">Enter AR</button>
    
    <script>
      let xrSession = null;
      let xrHitTestSource = null;
      let xrRefSpace = null;

      const button = document.getElementById('enter-ar');
      if (navigator.xr) {
  navigator.xr.isSessionSupported('immersive-ar').then((supported) => {
    if (supported) {
      console.log('AR supported');
      // Proceed with session request here
    } else {
      console.log('AR not supported');
      alert('AR not supported on this device/browser.');
    }
  });
} else {
  console.log('WebXR is not available on this browser.');
  alert('WebXR is not available on this browser.');
}

      
      // Request the XR session
      button.addEventListener('click', async () => {
        if (navigator.xr) {
          xrSession = await navigator.xr.requestSession('immersive-ar', {
            requiredFeatures: ['hit-test', 'local-floor'],
          });

          // Create an XRReferenceSpace for positioning
          xrRefSpace = await xrSession.requestReferenceSpace('local-floor');

          // Create hit-test source
          const viewerSpace = await xrSession.requestReferenceSpace('viewer');
          xrHitTestSource = await xrSession.requestHitTestSource({
            space: viewerSpace
          });

          // Start rendering
          xrSession.requestAnimationFrame(onXRFrame);
        } else {
          alert('WebXR is not supported on this device/browser.');
        }
      });

      // Handle the frame-by-frame rendering in XR session
      function onXRFrame(time, frame) {
        const session = frame.session;
        session.requestAnimationFrame(onXRFrame);

        const pose = frame.getViewerPose(xrRefSpace);

        if (pose) {
          const hitTestResults = frame.getHitTestResults(xrHitTestSource);
          if (hitTestResults.length > 0) {
            const hit = hitTestResults[0];
            const hitPose = hit.getPose(xrRefSpace);

            // Log the plane detection
            console.log('Plane detected at:', hitPose.transform.position);
            
            // You can place 3D objects at hitPose.transform.position
            // For example, using Three.js or A-Frame to add a box at the detected plane
          }
        }
      }
    </script>
  </body>
</html>
